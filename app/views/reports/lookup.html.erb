<% content_for :header_title, "Consultar Relato de Ouvidoria" %>
<% content_for :header_desc, "Acompanhe o andamento da sua denúncia anônima ou identificada." %>

<article class="card" style="max-width: 500px; margin: 0 auto;">
  <%# Instructional Note to reinforce process separation %>
  <p style="margin-bottom: 1.5rem; color: var(--text-muted); font-size: 0.85rem; line-height: 1.4;">
    <strong>Aviso:</strong> Este canal é exclusivo para a consulta de <strong>Relatos de Ouvidoria</strong>. 
    Protocolos de Questionários de Due Diligence não são processados por este formulário.
  </p>

  <% if params[:protocolo].present? && @report.nil? %>
    <div class="report-form__feedback" style="margin-bottom: 1.5rem; background-color: #fef2f2; border: 1px solid #f87171; color: #991b1b; padding: 1rem; border-radius: 8px;">
      <strong>Não encontrado:</strong> O protocolo <code><%= params[:protocolo] %></code> não foi localizado ou não pertence ao Canal de Ouvidoria.
    </div>
  <% end %>

  <%= form_with url: lookup_report_path, method: :get, class: "report-form", data: { turbo: false } do |f| %>
    <div class="form-field">
      <%= f.label :protocolo, "Número do Protocolo de Relato" %>
      <%= f.text_field :protocolo, 
          placeholder: "Ex: CD-A1B2-C3D4", 
          class: "form-input", 
          value: params[:protocolo],
          required: true,
          style: "text-transform: uppercase;" %>
    </div>
    
    <%= f.submit "Pesquisar Status", class: "button button--primary", style: "width: 100%;" %>
  <% end %>

  <% if @report %>
    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
      <h3 style="margin-bottom: 1rem;">Status do Relato</h3>
      <div style="display: flex; justify-content: space-between; align-items: center; background: var(--bg-secondary); padding: 1rem; border-radius: 8px;">
        <span><strong>Protocolo:</strong> <%= @report.protocolo %></span>
        <span class="badge badge--status-<%= @report.status %>" style="font-weight: bold;">
          <%= @report.status.humanize %>
        </span>
      </div>
      
      <p style="margin-top: 1rem; color: var(--text-muted); font-size: 0.9rem;">
        <strong>Última atualização:</strong> <%= @report.updated_at.strftime("%d/%m/%Y às %H:%M") %>
      </p>

      <%= link_to "Ver Detalhes do Relato", report_path(@report), class: "button button--outline", style: "width: 100%; margin-top: 1.5rem; text-align: center; display: block;" %>
    </div>
  <% end %>
</article>